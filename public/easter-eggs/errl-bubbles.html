<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Errl's Neon Dream</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #0f172a;
        color: white;
        overflow: hidden;
        overscroll-behavior: none;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .neon-text {
        text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #0ff, 0 0 30px #0ff, 0 0 40px #0ff;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useEffect, useRef, useState } from 'https://esm.sh/react@19.2.4';
      import ReactDOM from 'https://esm.sh/react-dom@19.2.4/client';
      import Matter from 'https://esm.sh/matter-js@0.20.0';
      import { motion, useMotionValue } from 'https://esm.sh/framer-motion@12.29.2';
      import { RefreshCcw, Crosshair, Hand } from 'https://esm.sh/lucide-react@0.563.0';

      // --- Components ---

      const ErrlSVG = ({ isGlowing, className = '' }) => {
        const strokeColor = isGlowing ? "#00ffff" : "#e5eef7";
        const glowFilter = isGlowing ? "drop-shadow(0 0 8px #00ffff) drop-shadow(0 0 15px #ff00ff)" : "none";
        const fillColor = isGlowing ? "#111" : "#000";

        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 1000 1000"
            className={`${className} transition-all duration-300`}
            style={{ filter: glowFilter }}
            preserveAspectRatio="xMidYMid meet"
          >
            <g transform="translate(50,-50) scale(.8)">
              <g id="region-face">
                <path fill={fillColor} stroke={strokeColor} strokeWidth="6" strokeLinejoin="round" strokeLinecap="round" d="M541 197 L542 196 L581 196 L582 197 L599 197 L600 198 L609 198 L610 199 L618 199 L619 200 L626 200 L627 201 L633 201 L634 202 L639 202 L640 203 L646 203 L647 204 L652 204 L653 205 L657 205 L658 206 L662 206 L663 207 L667 207 L668 208 L671 208 L672 209 L675 209 L676 210 L679 210 L680 211 L683 211 L684 212 L687 212 L688 213 L690 213 L691 214 L694 214 L695 215 L697 215 L698 216 L700 216 L701 217 L704 217 L705 218 L707 218 L708 219 L710 219 L711 220 L713 220 L714 221 L716 221 L717 222 L719 222 L720 223 L722 223 L723 224 L725 224 L726 225 L728 225 L729 226 L731 226 L732 227 L733 227 L734 228 L736 228 L737 229 L738 229 L739 230 L741 230 L742 231 L744 231 L745 232 L746 232 L747 233 L748 233 L749 234 L751 234 L752 235 L753 235 L754 236 L755 236 L756 237 L757 237 L758 238 L760 238 L761 239 L762 239 L763 240 L764 240 L765 241 L766 241 L767 242 L768 242 L769 243 L770 243 L771 244 L773 244 L774 245 L775 245 L776 246 L777 246 L778 247 L779 247 L780 248 L781 248 L782 249 L783 249 L784 250 L785 250 L786 251 L787 251 L788 252 L789 252 L790 253 L791 253 L793 255 L794 255 L795 256 L796 256 L797 257 L798 257 L799 258 L800 258 L802 260 L803 260 L804 261 L805 261 L806 262 L807 262 L809 264 L810 264 L811 265 L812 265 L814 267 L815 267 L816 268 L817 268 L819 270 L820 270 L821 271 L822 271 L824 273 L825 273 L827 275 L828 275 L830 277 L831 277 L833 279 L834 279 L836 281 L837 281 L840 284 L841 284 L843 286 L844 286 L847 289 L848 289 L850 291 L851 291 L854 294 L855 294 L858 297 L859 297 L863 301 L864 301 L869 306 L870 306 L874 310 L875 310 L880 315 L881 315 L890 324 L891 324 L892 325 L892 326 L893 326 L919 352 L919 353 L929 363 L929 364 L933 368 L933 369 L939 375 L939 376 L943 380 L943 381 L947 385 L947 386 L950 389 L950 390 L952 392 L952 393 L955 396 L955 397 L958 400 L958 401 L960 403 L960 404 L963 407 L963 408 L965 410 L965 411 L967 413 L967 414 L969 416 L969 417 L971 419 L971 420 L972 421 L972 422 L974 424 L974 425 L976 427 L976 428 L977 429 L977 430 L979 432 L979 433 L980 434 L980 435 L982 437 L982 438 L983 439 L983 440 L985 442 L985 443 L986 444 L986 445 L987 446 L987 447 L988 448 L988 449 L990 451 L990 452 L991 453 L991 454 L992 455 L992 456 L993 457 L993 458 L994 459 L994 460 L995 461 L995 462 L996 463 L996 464 L997 465 L997 466 L998 467 L998 468 L999 469 L999 470 L1000 471 L1000 472 L1001 473 L1001 474 L1002 475 L1002 476 L1003 477 L1003 478 L1004 479 L1004 481 L1005 482 L1005 483 L1006 484 L1006 485 L1007 486 L1007 487 L1008 488 L1008 489 L1009 490 L1009 492 L1010 493 L1010 494 L1011 495 L1011 497 L1012 498 L1012 499 L1013 500 L1013 501 L1014 502 L1014 504 L1015 505 L1015 507 L1016 508 L1016 509 L1017 510 L1017 512 L1018 513 L1018 515 L1019 516 L1019 518 L1020 519 L1020 521 L1021 522 L1021 523 L1022 524 L1022 526 L1023 527 L1023 529 L1024 530 L1024 532 L1025 533 L1025 535 L1026 536 L1026 538 L1027 539 L1027 541 L1028 542 L1028 545 L1029 546 L1029 548 L1030 549 L1030 552 L1031 553 L1031 555 L1032 556 L1032 559 L1033 560 L1033 563 L1034 564 L1034 567 L1035 568 L1035 571 L1036 572 L1036 576 L1037 577 L1037 581 L1038 582 L1038 585 L1039 586 L1039 591 L1040 592 L1040 596 L1041 597 L1041 602 L1042 603 L1042 608 L1043 609 L1043 615 L1044 616 L1044 622 L1045 623 L1045 631 L1046 632 L1046 641 L1047 642 L1047 655 L1048 656 L1048 709 L1047 710 L1047 723 L1046 724 L1046 733 L1045 734 L1045 742 L1044 743 L1044 749 L1043 750 L1043 756 L1042 757 L1042 762 L1041 763 L1041 768 L1040 769 L1040 773 L1039 774 L1039 778 L1038 779 L1038 783 L1037 784 L1037 788 L1036 789 L1036 793 L1035 794 L1035 797 L1034 798 L1034 801 L1033 802 L1033 805 L1032 806 L1032 808 L1031 809 L1031 812 L1030 813 L1030 816 L1029 817 L1029 819 L1028 820 L1028 822 L1027 823 L1027 825 L1026 826 L1026 828 L1025 829 L1025 831 L1024 832 L1024 835 L1023 836 L1023 837 L1022 838 L1022 840 L1021 841 L1021 843 L1020 844 L1020 846 L1019 847 L1019 849 L1018 850 L1018 851 L1017 852 L1017 854 L1016 855 L1016 857 L1015 858 L1015 860 L1014 861 L1014 862 L1013 863 L1013 865 L1012 866 L1012 867 L1011 868 L1011 870 L1010 871 L1010 872 L1009 873 L1009 874 L1008 875 L1008 876 L1007 877 L1007 879 L1006 880 L1006 881 L1005 882 L1005 883 L1004 884 L1004 885 L1003 886 L1003 887 L1002 888 L1002 889 L1001 890 L1001 892 L1000 893 L1000 894 L999 895 L999 896 L998 897 L998 898 L997 899 L997 900 L996 901 L996 902 L995 903 L995 904 L994 905 L994 906 L993 907 L993 908 L992 909 L992 910 L991 911 L991 912 L989 914 L989 915 L988 916 L988 917 L987 918 L987 919 L986 920 L986 921 L984 923 L984 924 L983 925 L983 926 L981 928 L981 929 L980 930 L980 931 L979 932 L979 933 L977 935 L977 936 L975 938 L975 939 L974 940 L974 941 L972 943 L972 944 L971 945 L971 946 L969 948 L969 949 L967 951 L967 952 L965 954 L965 955 L963 957 L963 958 L960 961 L960 962 L958 964 L958 965 L955 968 L955 969 L952 972 L952 973 L950 975 L950 976 L946 980 L946 981 L943 984 L943 985 L939 989 L939 990 L934 995 L934 996 L928 1002 L928 1003 L919 1012 L919 1013 L894 1038 L893 1038 L893 1039 L892 1040 L891 1040 L882 1049 L881 1049 L875 1055 L874 1055 L870 1059 L869 1059 L865 1063 L864 1063 L860 1067 L859 1067 L856 1070 L855 1070 L851 1074 L850 1074 L848 1076 L847 1076 L844 1079 L843 1079 L841 1081 L840 1081 L838 1083 L837 1083 L835 1085 L834 1085 L832 1087 L831 1087 L829 1089 L828 1089 L826 1091 L825 1091 L823 1093 L822 1093 L820 1095 L819 1095 L818 1096 L817 1096 L815 1098 L814 1098 L813 1099 L812 1099 L810 1101 L809 1101 L808 1102 L807 1102 L805 1104 L804 1104 L803 1105 L802 1105 L801 1106 L800 1106 L799 1107 L798 1107 L796 1109 L795 1109 L794 1110 L793 1110 L792 1111 L791 1111 L790 1112 L789 1112 L788 1113 L787 1113 L785 1115 L784 1115 L783 1116 L782 1116 L781 1117 L780 1117 L779 1118 L778 1118 L777 1119 L776 1119 L775 1120 L774 1120 L773 1121 L772 1121 L771 1122 L769 1122 L768 1123 L767 1123 L766 1124 L765 1124 L764 1125 L763 1125 L762 1126 L760 1126 L759 1127 L758 1127 L757 1128 L756 1128 L755 1129 L753 1129 L752 1130 L751 1130 L750 1131 L749 1131 L748 1132 L746 1132 L745 1133 L744 1133 L743 1134 L742 1134 L741 1135 L739 1135 L738 1136 L736 1136 L735 1137 L734 1137 L733 1138 L731 1138 L730 1139 L729 1139 L728 1140 L726 1140 L725 1141 L723 1141 L722 1142 L720 1142 L719 1143 L717 1143 L716 1144 L714 1144 L713 1145 L711 1145 L710 1146 L708 1146 L707 1147 L704 1147 L703 1148 L701 1148 L700 1149 L697 1149 L696 1150 L694 1150 L693 1151 L690 1151 L689 1152 L687 1152 L686 1153 L683 1153 L682 1154 L679 1154 L678 1155 L675 1155 L674 1156 L671 1156 L670 1157 L667 1157 L666 1158 L662 1158 L661 1159 L657 1159 L656 1160 L652 1160 L651 1161 L647 1161 L646 1162 L641 1162 L640 1163 L634 1163 L633 1164 L627 1164 L626 1165 L619 1165 L618 1166 L610 1166 L609 1167 L598 1167 L597 1168 L578 1168 L577 1169 L545 1169 L544 1168 L526 1168 L525 1167 L514 1167 L513 1166 L505 1166 L504 1165 L497 1165 L496 1164 L490 1164 L489 1163 L483 1163 L482 1162 L478 1162 L477 1161 L472 1161 L471 1160 L467 1160 L466 1159 L462 1159 L461 1158 L458 1158 L457 1157 L454 1157 L453 1156 L449 1156 L448 1155 L445 1155 L444 1154 L442 1154 L441 1153 L438 1153 L437 1152 L434 1152 L433 1151 L430 1151 L429 1150 L427 1150 L426 1149 L424 1149 L423 1148 L420 1148 L419 1147 L417 1147 L416 1146 L414 1146 L413 1145 L411 1145 L410 1144 L407 1144 L406 1143 L404 1143 L403 1142 L402 1142 L401 1141 L399 1141 L398 1140 L396 1140 L395 1139 L393 1139 L392 1138 L391 1138 L390 1137 L388 1137 L387 1136 L386 1136 L385 1135 L383 1135 L382 1134 L381 1134 L380 1133 L378 1133 L377 1132 L376 1132 L375 1131 L374 1131 L373 1130 L371 1130 L370 1129 L369 1129 L368 1128 L367 1128 L366 1127 L364 1127 L363 1126 L362 1126 L361 1125 L360 1125 L359 1124 L358 1124 L357 1123 L356 1123 L355 1122 L353 1122 L352 1121 L351 1121 L350 1120 L349 1120 L348 1119 L347 1119 L346 1118 L345 1118 L344 1117 L343 1117 L342 1116 L341 1116 L340 1115 L339 1115 L338 1114 L337 1114 L335 1112 L334 1112 L333 1111 L332 1111 L331 1110 L330 1110 L329 1109 L328 1109 L327 1108 L326 1108 L324 1106 L323 1106 L322 1105 L321 1105 L320 1104 L319 1104 L318 1103 L317 1103 L315 1101 L314 1101 L313 1100 L312 1100 L310 1098 L309 1098 L308 1097 L307 1097 L305 1095 L304 1095 L303 1094 L302 1094 L300 1092 L299 1092 L297 1090 L296 1090 L294 1088 L293 1088 L291 1086 L290 1086 L287 1083 L286 1083 L284 1081 L283 1081 L281 1079 L280 1079 L278 1077 L277 1077 L274 1074 L273 1074 L270 1071 L269 1071 L265 1067 L264 1067 L261 1064 L260 1064 L256 1060 L255 1060 L251 1056 L250 1056 L243 1049 L242 1049 L235 1042 L234 1042 L202 1010 L202 1009 L195 1002 L195 1001 L188 994 L188 993 L183 988 L183 987 L180 984 L180 983 L177 980 L177 979 L174 976 L174 975 L171 972 L171 971 L167 967 L167 966 L165 964 L165 963 L163 961 L163 960 L161 958 L161 957 L159 955 L159 954 L157 952 L157 951 L155 949 L155 948 L153 946 L153 945 L151 943 L151 942 L149 940 L149 939 L148 938 L148 937 L146 935 L146 934 L144 932 L144 931 L143 930 L143 929 L142 928 L142 927 L140 925 L140 924 L139 923 L139 922 L138 921 L138 920 L137 919 L137 918 L135 916 L135 915 L134 914 L134 913 L133 912 L133 911 L132 910 L132 909 L131 908 L131 907 L130 906 L130 905 L129 904 L129 903 L128 902 L128 901 L126 899 L126 898 L125 897 L125 896 L124 895 L124 894 L123 893 L123 891 L122 890 L122 889 L121 888 L121 887 L120 886 L120 885 L119 884 L119 883 L118 882 L118 881 L117 880 L117 878 L116 877 L116 876 L115 875 L115 873 L114 872 L114 871 L113 870 L113 869 L112 868 L112 866 L111 865 L111 864 L110 863 L110 861 L109 860 L109 859 L108 858 L108 856 L107 855 L107 853 L106 852 L106 851 L105 850 L105 848 L104 847 L104 845 L103 844 L103 843 L102 842 L102 840 L101 839 L101 837 L100 836 L100 834 L99 833 L99 831 L98 830 L98 828 L97 827 L97 824 L96 823 L96 821 L95 820 L95 817 L94 816 L94 813 L93 812 L93 810 L92 809 L92 806 L91 805 L91 802 L90 801 L90 798 L89 797 L89 794 L88 793 L88 790 L87 789 L87 785 L86 784 L86 781 L85 780 L85 776 L84 775 L84 771 L83 770 L83 765 L82 764 L82 759 L81 758 L81 753 L80 752 L80 746 L79 745 L79 738 L78 737 L78 728 L77 727 L77 716 L76 715 L76 693 L75 692 L75 671 L76 670 L76 650 L77 649 L77 637 L78 636 L78 628 L79 627 L79 620 L80 619 L80 613 L81 612 L81 606 L82 605 L82 600 L83 599 L83 595 L84 594 L84 590 L85 589 L85 585 L86 584 L86 580 L87 579 L87 576 L88 575 L88 572 L89 571 L89 568 L90 567 L90 564 L91 563 L91 560 L92 559 L92 556 L93 555 L93 552 L94 551 L94 549 L95 548 L95 545 L96 544 L96 542 L97 541 L97 538 L98 537 L98 535 L99 534 L99 532 L100 531 L100 529 L101 528 L101 526 L102 525 L102 523 L103 522 L103 520 L104 519 L104 518 L105 517 L105 515 L106 514 L106 512 L107 511 L107 510 L108 509 L108 507 L109 506 L109 505 L110 504 L110 502 L111 501 L111 500 L112 499 L112 497 L113 496 L113 495 L114 494 L114 492 L115 491 L115 490 L116 489 L116 488 L117 487 L117 485 L118 484 L118 483 L119 482 L119 481 L120 480 L120 479 L121 478 L121 476 L123 474 L123 472 L124 471 L124 470 L125 469 L125 468 L126 467 L126 466 L127 465 L127 464 L128 463 L128 462 L129 461 L129 460 L131 458 L131 457 L132 456 L132 455 L133 454 L133 453 L134 452 L134 451 L135 450 L135 449 L136 448 L136 447 L138 445 L138 444 L139 443 L139 442 L140 441 L140 440 L141 439 L141 438 L143 436 L143 435 L144 434 L144 433 L146 431 L146 430 L147 429 L147 428 L149 426 L149 425 L151 423 L151 422 L153 420 L153 419 L155 417 L155 416 L156 415 L156 414 L158 412 L158 411 L160 409 L160 408 L162 406 L162 405 L165 402 L165 401 L167 399 L167 398 L170 395 L170 394 L173 391 L173 390 L176 387 L176 386 L179 383 L179 382 L183 378 L183 377 L188 372 L188 371 L193 366 L193 365 L200 358 L200 357 L235 322 L236 322 L236 321 L237 320 L238 320 L244 314 L245 314 L250 309 L251 309 L256 304 L257 304 L261 300 L262 300 L265 297 L266 297 L270 293 L271 293 L273 291 L274 291 L277 288 L278 288 L280 286 L281 286 L284 283 L285 283 L287 281 L288 281 L290 279 L291 279 L293 277 L294 277 L296 275 L297 275 L299 273 L300 273 L302 271 L303 271 L304 270 L305 270 L307 268 L308 268 L309 267 L310 267 L312 265 L313 265 L314 264 L315 264 L317 262 L318 262 L319 261 L320 261 L322 259 L323 259 L324 258 L325 258 L326 257 L327 257 L329 255 L330 255 L331 254 L332 254 L333 253 L334 253 L335 252 L336 252 L337 251 L338 251 L339 250 L340 250 L341 249 L342 249 L343 248 L344 248 L345 247 L346 247 L347 246 L348 246 L349 245 L350 245 L351 244 L352 244 L353 243 L354 243 L355 242 L357 242 L358 241 L359 241 L360 240 L361 240 L362 239 L363 239 L364 238 L365 238 L366 237 L367 237 L368 236 L370 236 L371 235 L372 235 L373 234 L374 234 L375 233 L377 233 L378 232 L379 232 L380 231 L382 231 L383 230 L384 230 L385 229 L387 229 L388 228 L389 228 L390 227 L392 227 L393 226 L395 226 L396 225 L398 225 L399 224 L401 224 L402 223 L404 223 L405 222 L407 222 L408 221 L410 221 L411 220 L413 220 L414 219 L416 219 L417 218 L419 218 L420 217 L422 217 L423 216 L426 216 L427 215 L429 215 L430 214 L432 214 L433 213 L436 213 L437 212 L440 212 L441 211 L444 211 L445 210 L448 210 L449 209 L452 209 L453 208 L456 208 L457 207 L461 207 L462 206 L466 206 L467 205 L471 205 L472 204 L476 204 L477 203 L483 203 L484 202 L489 202 L490 201 L496 201 L497 200 L504 200 L505 199 L513 199 L514 198 L525 198 L526 197 Z" />
                </g>
              </g>
            </svg>
          );
        };

        const getRainbowColor = (hue, alpha = 1) => `hsla(${hue}, 100%, 70%, ${alpha})`;

        const InteractiveCard = () => {
          const containerRef = useRef(null);
          const canvasRef = useRef(null);
          const engineRef = useRef(null);
          const renderRef = useRef(null);
          const faceBodyRef = useRef(null);
          const floatState = useRef('falling');
          const faceX = useMotionValue(0);
          const faceY = useMotionValue(0);
          
          const [aimOrigin, setAimOrigin] = useState({ x: 0, y: 0 });
          const [dragStart, setDragStart] = useState(null);
          const [dragCurrent, setDragCurrent] = useState(null);
          const [mode, setMode] = useState('move');
          
          // Force update for bubble count
          const [bubbleCount, setBubbleCount] = useState(0);

          const PARTICLE_LIMIT = 600; 

          useEffect(() => {
            if (!containerRef.current || !canvasRef.current) return;

            const width = containerRef.current.clientWidth;
            const height = containerRef.current.clientHeight;

            const startX = width / 2;
            const startY = height / 2;
            faceX.set(startX - 64);
            faceY.set(startY - 64);

            const engine = Matter.Engine.create();
            engine.gravity.y = 0.5; 
            engineRef.current = engine;

            const renderCanvas = canvasRef.current;
            renderCanvas.width = width;
            renderCanvas.height = height;
            const ctx = renderCanvas.getContext('2d');

            const wallOptions = { isStatic: true, render: { visible: false } };
            const walls = [
              Matter.Bodies.rectangle(width / 2, height + 50, width, 100, { ...wallOptions, label: 'floor' }),
              Matter.Bodies.rectangle(-50, height / 2, 100, height * 2, { ...wallOptions, label: 'wall' }),
              Matter.Bodies.rectangle(width + 50, height / 2, 100, height * 2, { ...wallOptions, label: 'wall' }),
              Matter.Bodies.rectangle(width / 2, -100, width, 100, { ...wallOptions, label: 'ceiling' }),
            ];
            Matter.World.add(engine.world, walls);

            const faceBody = Matter.Bodies.circle(startX, startY, 60, {
                label: 'face',
                restitution: 0.9,
                friction: 0.05,
                frictionAir: 0.08,
                density: 0.04,
                render: { visible: false } 
            });
            faceBodyRef.current = faceBody;
            Matter.World.add(engine.world, faceBody);

            Matter.Events.on(engine, 'collisionStart', (event) => {
                const pairs = event.pairs;
                for (let i = 0; i < pairs.length; i++) {
                    const { bodyA, bodyB } = pairs[i];
                    const face = bodyA.label === 'face' ? bodyA : bodyB.label === 'face' ? bodyB : null;
                    if (!face) continue;
                    const other = bodyA === face ? bodyB : bodyA;
                    if (other.label === 'floor') {
                        floatState.current = 'rising';
                    } else if (other.label === 'ceiling') {
                        floatState.current = 'falling';
                    }
                }
            });

            const renderLoop = () => {
              if (!ctx || !engineRef.current) return;
              
              if (faceBodyRef.current && !faceBodyRef.current.isStatic && floatState.current === 'rising') {
                  Matter.Body.applyForce(faceBodyRef.current, faceBodyRef.current.position, { 
                      x: 0, 
                      y: -0.0025 * faceBodyRef.current.mass
                  });
              }

              Matter.Engine.update(engineRef.current, 1000 / 60);

              if (faceBodyRef.current) {
                  const { x, y } = faceBodyRef.current.position;
                  faceX.set(x - 64);
                  faceY.set(y - 64);
              }

              ctx.clearRect(0, 0, width, height);

              const bodies = Matter.Composite.allBodies(engine.world);
              setBubbleCount(bodies.length - 5); // Approx count excluding walls/face (throttling state updates in RAF is bad, but for this demo ok, or optimize later)
              
              bodies.forEach(body => {
                if (body.isStatic || body.label === 'face') return;

                const { x, y } = body.position;
                const radius = body.circleRadius || 4;

                ctx.beginPath();
                const hue = body.hue || 0;
                const gradient = ctx.createRadialGradient(x - radius/3, y - radius/3, radius * 0.1, x, y, radius);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)'); 
                gradient.addColorStop(0.8, getRainbowColor(hue, 0.1)); 
                gradient.addColorStop(1, getRainbowColor(hue + 30, 0.6)); 

                ctx.fillStyle = gradient;
                ctx.strokeStyle = getRainbowColor(hue, 0.8);
                ctx.lineWidth = 1.5;
                
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();

                ctx.beginPath();
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.arc(x - radius * 0.4, y - radius * 0.4, radius * 0.2, 0, 2 * Math.PI);
                ctx.fill();
              });

              if (bodies.length > PARTICLE_LIMIT) {
                 const offScreen = bodies.filter(b => !b.isStatic && b.label !== 'face' && b.position.y > height + 100);
                 if (offScreen.length > 0) {
                     Matter.World.remove(engine.world, offScreen);
                 } else {
                     const oldest = bodies.find(b => !b.isStatic && b.label !== 'face' && (b.id % 2 === 0));
                     if(oldest) Matter.World.remove(engine.world, oldest);
                 }
              }

              renderRef.current = requestAnimationFrame(renderLoop);
            };

            renderRef.current = requestAnimationFrame(renderLoop);

            return () => {
              if (renderRef.current) cancelAnimationFrame(renderRef.current);
              Matter.Engine.clear(engine);
            };
          }, []);

          const handlePointerDown = (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (!faceBodyRef.current || !containerRef.current) return;
            floatState.current = 'falling';
            const rect = containerRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            const facePos = faceBodyRef.current.position;
            const dist = Math.sqrt(Math.pow(x - facePos.x, 2) + Math.pow(y - facePos.y, 2));

            if (dist <= 70) { 
                setDragStart({ x, y });
                setDragCurrent({ x, y });
                setAimOrigin({ x: facePos.x, y: facePos.y });
                Matter.Body.setStatic(faceBodyRef.current, true);
            }
          };

          const handlePointerMove = (e) => {
            if (!dragStart || !containerRef.current || !engineRef.current || !faceBodyRef.current) return;
            const rect = containerRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            setDragCurrent({ x, y });

            if (mode === 'move') {
                Matter.Body.setPosition(faceBodyRef.current, { x, y });
                setDragStart({ x, y });
                if (Math.random() > 0.3) {
                    const emitX = x + (Math.random() - 0.5) * 60;
                    const emitY = y + 50;
                    const hue = (Date.now() / 2) % 360;
                    const foam = Matter.Bodies.circle(emitX, emitY, 2 + Math.random() * 4, {
                        restitution: 0.6,
                        friction: 0.05,
                        frictionAir: 0.02,
                        density: 0.001,
                        label: 'bubble'
                    });
                    foam.hue = hue;
                    Matter.World.add(engineRef.current.world, foam);
                }
            } 
          };

          const handlePointerUp = () => {
            if (!faceBodyRef.current || !engineRef.current) {
                setDragStart(null);
                setDragCurrent(null);
                return;
            }
            if (mode === 'move') {
                Matter.Body.setStatic(faceBodyRef.current, false);
                if (dragStart && dragCurrent) {
                    const vx = (dragCurrent.x - dragStart.x) * 0.2;
                    const vy = (dragCurrent.y - dragStart.y) * 0.2;
                    Matter.Body.setVelocity(faceBodyRef.current, { x: vx, y: vy });
                }
            }
            else if (mode === 'shoot' && dragStart && dragCurrent) {
                const dx = dragStart.x - dragCurrent.x;
                const dy = dragStart.y - dragCurrent.y;
                const mag = Math.sqrt(dx * dx + dy * dy);
                Matter.Body.setStatic(faceBodyRef.current, false);
                if (mag > 20) {
                    const centerX = aimOrigin.x; 
                    const centerY = aimOrigin.y;
                    const size = 15 + Math.min(mag / 10, 40);
                    const bubble = Matter.Bodies.circle(centerX, centerY, size, {
                        restitution: 0.95,
                        friction: 0.001,
                        frictionAir: 0.005,
                        density: 0.001,
                        label: 'bubble'
                    });
                    bubble.hue = Math.random() * 360;
                    const forceMultiplier = 0.0002 * size;
                    Matter.Body.applyForce(bubble, bubble.position, {
                        x: dx * forceMultiplier,
                        y: dy * forceMultiplier
                    });
                    Matter.World.add(engineRef.current.world, bubble);
                    Matter.Body.applyForce(faceBodyRef.current, faceBodyRef.current.position, {
                        x: -dx * forceMultiplier * 5, 
                        y: -dy * forceMultiplier * 5
                    });
                }
            }
            setDragStart(null);
            setDragCurrent(null);
          };

          const clearPhysics = () => {
              if (!engineRef.current) return;
              const bodiesToRemove = Matter.Composite.allBodies(engineRef.current.world).filter(b => !b.isStatic && b.label !== 'face');
              Matter.World.remove(engineRef.current.world, bodiesToRemove);
          };

          const slingshotLine = mode === 'shoot' && dragStart && dragCurrent ? (
              <svg className="absolute inset-0 pointer-events-none z-30 w-full h-full overflow-visible">
                  <line 
                    x1={aimOrigin.x} 
                    y1={aimOrigin.y} 
                    x2={dragCurrent.x} 
                    y2={dragCurrent.y} 
                    stroke="rgba(255,255,255,0.3)" 
                    strokeWidth="2" 
                    strokeDasharray="5,5"
                  />
                  <line 
                    x1={aimOrigin.x} 
                    y1={aimOrigin.y} 
                    x2={aimOrigin.x + (dragStart.x - dragCurrent.x)} 
                    y2={aimOrigin.y + (dragStart.y - dragCurrent.y)} 
                    stroke="rgba(0,255,255,0.6)" 
                    strokeWidth="4" 
                    strokeLinecap="round"
                  />
                  <circle cx={dragCurrent.x} cy={dragCurrent.y} r="8" fill="rgba(255,255,255,0.5)" />
              </svg>
          ) : null;

          return (
            <div 
                className="flex flex-col items-center justify-center min-h-screen bg-slate-900 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-purple-900 to-slate-900 p-4 select-none"
                onContextMenu={(e) => e.preventDefault()}
            >
              <div 
                ref={containerRef}
                className="relative w-full max-w-lg aspect-[3/4] bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl shadow-2xl overflow-hidden cursor-crosshair touch-none"
                onPointerDown={handlePointerDown}
                onPointerMove={handlePointerMove}
                onPointerUp={handlePointerUp}
                onPointerLeave={handlePointerUp}
              >
                <div className="absolute top-0 left-0 w-full p-5 z-40 flex justify-between items-start pointer-events-none bg-gradient-to-b from-black/60 to-transparent">
                    <div 
                        className="flex flex-col gap-2 pointer-events-auto"
                        onPointerDown={(e) => e.stopPropagation()}
                    >
                        <h1 className="text-white font-bold text-xl drop-shadow-md tracking-tight neon-text">Errl's Neon Dream</h1>
                        <div className="text-xs text-white/90 font-mono space-y-1.5 backdrop-blur-md bg-black/30 p-3 rounded-xl border border-white/10 shadow-lg">
                            <p className="flex items-center gap-2">
                                <span className={`w-2 h-2 rounded-full ${mode === 'move' ? 'bg-cyan-400' : 'bg-pink-500'} animate-pulse`}></span>
                                <span className="font-bold tracking-wider">{mode === 'move' ? 'GRAVITY' : 'SLINGSHOT'}</span>
                            </p>
                            <p className="opacity-70 text-[10px] leading-tight max-w-[140px]">
                                {mode === 'move' ? 'Drag face to spill foam. Sinks to bottom, floats to top.' : 'Drag & Release to shoot bubbles.'}
                            </p>
                            <div className="h-px bg-white/10 w-full"></div>
                            <p className="opacity-60 flex justify-between text-[10px]">
                                <span>BUBBLES</span>
                                <span className="font-bold text-cyan-200">{Math.max(0, bubbleCount)}</span>
                            </p>
                        </div>
                    </div>

                    <div 
                        className="flex flex-col gap-2 pointer-events-auto"
                        onPointerDown={(e) => e.stopPropagation()}
                        onPointerMove={(e) => e.stopPropagation()}
                    >
                        <button 
                            onClick={() => setMode('move')}
                            className={`p-3 rounded-xl backdrop-blur-md transition-all border border-white/10 hover:scale-105 active:scale-95 ${mode === 'move' ? 'bg-cyan-500/80 text-white shadow-[0_0_15px_#06b6d4]' : 'bg-black/40 text-white/70 hover:bg-white/20'}`}
                            title="Gravity Mode"
                        >
                            <Hand size={20} />
                        </button>
                        <button 
                            onClick={() => setMode('shoot')}
                            className={`p-3 rounded-xl backdrop-blur-md transition-all border border-white/10 hover:scale-105 active:scale-95 ${mode === 'shoot' ? 'bg-pink-500/80 text-white shadow-[0_0_15px_#ec4899]' : 'bg-black/40 text-white/70 hover:bg-white/20'}`}
                            title="Slingshot Mode"
                        >
                            <Crosshair size={20} />
                        </button>
                        <div className="h-2"></div>
                        <button 
                            onClick={clearPhysics}
                            className="p-3 rounded-xl bg-black/40 border border-white/10 text-white/70 backdrop-blur-md hover:bg-red-500/20 hover:text-red-200 hover:border-red-500/30 active:scale-95 transition-all"
                            title="Clear Bubbles"
                        >
                            <RefreshCcw size={20} />
                        </button>
                    </div>
                </div>

                <canvas 
                    ref={canvasRef}
                    className="absolute inset-0 pointer-events-none z-0"
                />

                {slingshotLine}

                <motion.div
                    className={`absolute z-10 w-32 h-32 ${mode === 'move' ? 'cursor-grab active:cursor-grabbing' : 'cursor-crosshair'}`}
                    style={{
                        x: faceX,
                        y: faceY
                    }}
                    animate={{
                        scale: dragStart && mode === 'shoot' ? 0.95 : 1, 
                    }}
                >
                    <ErrlSVG isGlowing={!!dragStart} className="w-full h-full drop-shadow-2xl" />
                </motion.div>

                <div className="absolute inset-0 pointer-events-none opacity-[0.03] bg-[url('https://grainy-gradients.vercel.app/noise.svg')] z-20 mix-blend-overlay"></div>
                <div className="absolute inset-0 pointer-events-none z-20 border-[0.5px] border-white/20 rounded-3xl box-border shadow-[inset_0_0_20px_rgba(255,255,255,0.05)]"></div>
              </div>
            </div>
          );
        };

        const App = () => {
          return (
            <div className="w-full h-full">
              <InteractiveCard />
            </div>
          );
        };

        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
  </body>
</html>